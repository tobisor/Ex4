<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>TO DO LISTS</title>
    <link rel="stylesheet" href="css/ItemStyle.css">
</head>
<meta name="viewport" content="width=device-width">
<body>

    <h1 style="color: #595959;display:inline-block;">WHAT DO I HAVE TO DO</h1><br>

    <h2 style="color: #595959;display:inline-block;">EDIT THE LISTS</h2><br>

    <div style="font-weight: bold">If you want to delete a list, please enter it's name.<br></div>
    <input type="deleteListName" id="deleteListName" placeholder="List name" required/>
    <button class = button id="dltLstBtn" type = 'button'>DELETE!</button>
    <br>

    <div style="font-weight: bold">If you want to add a list, please entername and color.<br></div>
    <input type="addListName" id="addListName" placeholder="List name" required/>
    <select type="addListName" id="addListcolor">
        <option value="#00ff00">Green</option>
        <option value="#ff0000">Red</option>
        <option value="#0000ff">Blue</option>
        <option value="#ffff00">Yellow</option>
    </select>
    <button class = button id="addLstBtn" type = 'button'>ADD!</button>
    <br>

    <div style="font-weight: bold">If you want to share a list, please enter list name and other user-name.<br></div>
    <input type="shareListName" id="shareListName" placeholder="List name" required/>
    <input type="shareListUserName" id="shareListUserName" placeholder="User name" required/>
    <button class = button id="shareLstBtn" type = 'button'>SHARE!</button>
    <br>

    <h2 style="color: #595959;display:inline-block;">EDIT ITEMS</h2><br>
    <div style="font-weight: bold">please enter list name and job<br></div>
    <input type="srchListName" id="srchListName" placeholder="List name" required/>
    <input type="jobName" id="jobName" placeholder="TODO" required/>
    <div style="font-weight: bold">what would you like to do?<br></div>
    <button class = button id="addItemBtn" type = 'button'>ADD!</button>
    <button class = button id="deleteItemBtn" type = 'button'>DELETE!</button>
    <button class = button id="serchItemBtn" type = 'button'>SEARCH!</button>
    <br>
    <br>

    <div id = "listsDiv" style=" ">
        <button class = button id="loadLstsBtn" type = 'button'>LOAD LISTS!</button>
        <table id = 'nextList'></table>
    </div>

    <br><button class = button id ="dltUserBtn" type = 'button'>Delete User</button>
        <button class = button id ="logOutBtn" type = 'button'>Log Out</button>

</body>
<script>
    var deafultColor = "#00ff00";
    $("#dltLstBtn").click(function(){
        var listName = $("#deleteListName").val();
        console.log("start list deletion");
        if (listName){
            deleteList(listName);
        }else {
            alert("Please insert valid name!")
        }
    });

    function deleteList(listName){
        $.ajax({
            url:"http://localhost:8080/item/"+listName,
            type: "DELETE",
            success: function(){
                alert("Deletion completed")
            },
            error: function (status) {
                if (status === 500){
                    window.parent.location = "http://localhost:8080/login";
                }else{
                    alert("missing list")
                }
            }
        })
    }

    $("#addLstBtn").click(function(){
       var obj = new Object();
       obj.name = $("#addListName").val();
       obj.color = ($("#addListcolor").val())? $("#addListcolor").val():deafultColor;
       var urlString = JSON.stringify(obj);
       console.log(urlString);
       if(obj.name){
           $.post("/item/" , urlString , function(data){
               console.log(data);
               if (data === "500") {
                   window.parent.location = "http://localhost:8080/login";
               } else if (data ==='404'){
                   alert('something went wrong');
               }else {
                   alert('new list added successfully');
               }
           });
       }else {
           alert('please insert valid name');
       }
        location.reload();
    })
///////////////LOG OUT AND DELETE USER////////////////
    $("#logOutBtn").click(logOut());

    $("#dltUserBtn").click(deleteUser());

    function deleteUser(){
        $.ajax({
            url:"http://localhost:8080/item/deleteUser",
            type: "DELETE",
            success: function(){
                alert("Deletion completed")
                window.parent.location = "http://localhost:8080/login";
            },
            error: function (status) {
                if (status === 500){
                    window.parent.location = "http://localhost:8080/login";
                }else{
                    alert("something went wrong :(")
                }
            }
        })
    }

    function logOut(){
        $.get("/logout/",function (data) {
            if (data === '500'){
                window.parent.location =  "http://localhost:8080/login";
            }else if(data === '404'){
                alert('something went wrong');
            }else {
                alert('loged out')
                window.parent.location =  "http://localhost:8080/login";
            }
        })
    }
   /////////////////////////////////////////////////////
    $("#shareLstBtn").click(function(){
        var obj = new Object();
        obj.listName = $("#shareListName").val();
        obj.otherUserName = $("#shareListUserName").val();
        var urlString = JSON.stringify(obj);
        console.log(urlString);
        if((obj.otherUserName)&&(obj.listName)){
            $.post("/item/share/", urlString , function(data) {
                console.log(data);
                if (data === "500") {
                    window.parent.location = "http://localhost:8080/login";
                } else if (data ==='404'){
                    alert('something went wrong');
                }else {
                    alert('new list added succesfuly');
                }
            })
        }else {
            alert('please insert valid inputs');
        }
    })


    /*//////////////DELETE ITEM FROM LIST////////////////*/

    $("#deleteItemBtn").click(function() {
        var listName = $("#srchListName").val();
        var itemName = $("#jobName").val();
        if((listName)&&(itemName)){
            deleteItem(listName,itemName);
        }else {
            alert("please enter valid inputs");
        }
    }

    function deleteItem(listName, itemName) {
        var obj = new Object();
        obj.listName = listName;
        obj.itemMame = itemName;
        var urlString = JSON.stringify(obj);
        $.ajax({
            url:"http://localhost:8080/item/deleteItem",
            type: "DELETE",
            data: urlString,
            success: function(){
                alert("Deletion completed")
                //TODO : get all lists
            },
            error: function (status) {
                if (status === 500){
                    window.parent.location = "http://localhost:8080/login";
                }else{
                    alert("something went wrong :(")
                }
            }
        })
    }

////////////////////////////////////////////////////////////////////////////////////////////////


    function showHide(num){
        var str = "table" + num;
        var e = document.getElementById(str);
        if (x.style.display === 'none') {
            x.style.display = 'block';
        } else {
            x.style.display = 'none';
        }
    }

    function printTable(list){
        var html = "<table border='1|1' id = 'itemTable'>";
        html += "<tr>";
        html += "<th>NAME</th>";

        html += "</tr>";
        for (var i = 0; i < data.length; i++) {

            if (data[i]) {
                html += "<tr>";
                html += "<td>" + list[i].name + "</td>";

                html += "</tr>";

            }
            html+="</table>";
            console.log(html);
            var table = document.createElement('table');
            table.id = "itemTable";
            table.cellSpacing = "10"
            table.innerHTML = html;
            table.color = "orange";
            document.getElementById('tableDiv').appendChild(table);
        }
    }
    /**
     * check if both inputs are not null
     * @returns {jQuery}
     */
    function checkValidity(){
        var listName = $("#srchListName").val();
        var jobName = $("#jobName").val();

        return ((listName)&&(jobName));
    }
</script>
</html>